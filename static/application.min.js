class haste_document{constructor(e){this.locked=!1,this.app=e}htmlEscape(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}load(e,n,i){let s=this;$.ajax(`${s.app.baseUrl}documents/${e}`,{type:"get",dataType:"json",success:function(t){s.locked=!0,s.key=e,s.data=t.data;let o;try{o="txt"==i?{value:s.htmlEscape(t.data)}:i?hljs.highlight(t.data,{language:i}):hljs.highlightAuto(t.data)}catch(e){o=hljs.highlightAuto(t.data)}n({value:o.value,key:e,language:o.language||i,lineCount:t.data.split("\n").length})},error:function(){n(!1)}})}save(o,n){if(this.locked)return!1;this.data=o;let i=this;$.ajax(`${i.app.baseUrl}documents`,{type:"post",data:o,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){i.locked=!0,i.key=e.key;var t=hljs.highlightAuto(o);n(null,{value:t.value,key:e.key,language:t.language,lineCount:o.split("\n").length})},error:function(e){try{n($.parseJSON(e.responseText))}catch(e){n({message:"Something went wrong!"})}}})}}class haste{constructor(e,t){this.appName=e,this.$textarea=$("textarea"),this.$box=$("#codeContainer"),this.$code=$("#codeContainer code"),this.$linenos=$(".numbers"),this.options=t,this.configureShortcuts(),this.configureButtons(),t.twitter||$("#codeContainer2 .twitter").hide(),this.baseUrl=t.baseUrl||"/"}setTitle(t){if(document.title=`${this.appName}${t?` - ${t}`:""}`,null!=t){let e=localStorage.getItem("storedFiles");e=e?e.split(","):[],0==e.includes(t)&&e.push(t),localStorage.setItem("storedFiles",e.toString())}return null}showMessage(e,t){let o=$(`<li class="${t||"info"}">${e}</li>`);$("#messages").prepend(o),setTimeout(function(){o.slideUp("fast",function(){$(this).remove()})},3e3)}lightKey(){this.configureKey(["new","save"])}fullKey(){this.configureKey(["new","duplicate","twitter","raw"])}configureKey(t){let o;$(".settings .icons").each(function(){o=$(this);for(const e of t)if(o.hasClass(e))return o.addClass("enabled"),!0;o.removeClass("enabled")})}newDocument(e){this.$box.hide(),this.doc=new haste_document(this),e||window.history.pushState(null,this.appName,this.baseUrl),this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()}),this.removeLineNumbers()}lookupExtensionByType(e){for(var t in haste.extensionMap)if(haste.extensionMap[t]==e)return t;return e}lookupTypeByExtension(e){return haste.extensionMap[e]||e}addLineNumbers(t){let o="";for(let e=0;e<t;e++)o+=(e+1).toString()+"<br/>";$(".numbers").html(o)}removeLineNumbers(){$(".numbers").html("&gt;")}loadDocument(e){e=e.split(".",2);let t=this;t.doc=new haste_document(this),t.doc.load(e[0],function(e){e?(t.$code.html(e.value),t.setTitle(e.key),t.fullKey(),t.$textarea.val("").hide(),t.$box.show().focus(),t.addLineNumbers(e.lineCount)):t.newDocument()},this.lookupTypeByExtension(e[1]))}duplicateDocument(){var e;this.doc.locked&&(e=this.doc.data,this.newDocument(),this.$textarea.val(e))}lockDocument(){let o=this;this.doc.save(this.$textarea.val(),function(e,t){if(e)o.showMessage(e.message,"error");else if(t){o.$code.html(t.value),o.setTitle(t.key);let e=o.baseUrl+t.key;t.language&&(e+=`.${o.lookupExtensionByType(t.language)}`),window.history.pushState(null,`${o.appName}-${t.key}`,e),o.fullKey(),o.$textarea.val("").hide(),o.$box.show().focus(),o.addLineNumbers(t.lineCount)}})}configureButtons(){let t=this;this.buttons=[{$where:$(".settings .icons.save"),label:"Save",shortcut:function(e){return e.ctrlKey&&83==e.keyCode},action:function(){""!=t.$textarea.val().replace(/^\s+|\s+$/g,"")&&t.lockDocument(),setTimeout(function(){copyButton.removeAttribute("disabled","")},500)}},{$where:$(".settings .icons.new"),label:"New",shortcut:function(e){return e.ctrlKey&&78==e.keyCode},shortcutDescription:"control + n",action:function(){t.newDocument(!t.doc.key)}},{$where:$(".settings .icons.duplicate"),label:"Duplicate & Edit",shortcut:function(e){return t.doc.locked&&e.ctrlKey&&68==e.keyCode},shortcutDescription:"control + d",action:function(){t.duplicateDocument()}},{$where:$(".settings .icons.raw"),label:"Just Text",shortcut:function(e){return e.ctrlKey&&e.shiftKey&&82==e.keyCode},shortcutDescription:"control + shift + r",action:function(){window.location.href=`${t.baseUrl}raw/${t.doc.key}`}},{$where:$("#codeContainer2 .twitter"),label:"Twitter",shortcut:function(e){return t.options.twitter&&t.doc.locked&&e.shiftKey&&e.ctrlKey&&84==e.keyCode},shortcutDescription:"control + shift + t",action:function(){window.open(`https://twitter.com/share?url=${encodeURI(window.location.href)}`)}}];for(const e of this.buttons)this.configureButton(e)}configureButton(t){t.$where.click(function(e){e.preventDefault(),!t.clickDisabled&&$(this).hasClass("enabled")&&t.action()}),t.$where.mouseenter(function(){$("#codeContainer3 .label").text(t.label),$("#codeContainer3 .shortcut").text(t.shortcutDescription||""),$("#codeContainer3").show(),$(this).append($("#pointer").remove().show())}),t.$where.mouseleave(function(){$("#codeContainer3").hide(),$("#pointer").hide()})}configureShortcuts(){let o=this;$(document.body).keydown(function(e){for(const t of o.buttons)if(t.shortcut&&t.shortcut(e))return e.preventDefault(),void t.action()})}}haste.extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown",txt:"",coffee:"coffee",swift:"swift"},$(function(){$("textarea").keydown(function(e){if(9==e.keyCode){e.preventDefault();var t,o,n="  ";if(document.selection){this.focus();let e=document.selection.createRange();e.text=n,this.focus()}else this.selectionStart||"0"==this.selectionStart?(t=this.selectionStart,o=this.selectionEnd,e=this.scrollTop,this.value=this.value.substring(0,t)+n+this.value.substring(o,this.value.length),this.focus(),this.selectionStart=t+n.length,this.selectionEnd=t+n.length,this.scrollTop=e):(this.value+=n,this.focus())}})});const copyButton=document.querySelector("#copy"),copyCodeButton=document.querySelector("#copyCode"),codeContainer=document.querySelector("code"),buttonOpenVersionContainer=document.querySelector("#openVersionContainer"),buttonCloseVersionContainer=document.querySelector("#closeVersionContainer"),versionContainer=document.querySelector("#versionContainer"),main=document.querySelector("main"),shareContainer=document.querySelector("#shareContainer");function copyUrl(){navigator.clipboard.writeText(window.location.href).then(function(){copyButton.style.background="#2ecc71",setTimeout(function(){copyButton.style.background="white"},3e3)},function(){console.warn("Echec de l'écriture dans le presse papiers")})}function copyCode(){navigator.clipboard.writeText(codeContainer.textContent).then(function(){copyCodeButton.style.background="#2ecc71",setTimeout(function(){copyCodeButton.style.background="white"},3e3)},function(){console.warn("Echec de l'écriture dans le presse papiers")})}function openVersionContainer(){versionContainer.setAttribute("data-visible","true"),main.setAttribute("open-version-container",""),fetchGithubData()}function closeVersionContainer(){versionContainer.setAttribute("data-visible","false"),main.removeAttribute("open-version-container","")}function openShareContainer(){shareContainer.toggleAttribute("open")}async function fetchGithubData(){var e="https://api.github.com/repos/zeis974/Securbin";const t=document.querySelector("#versionNumber"),o=document.querySelector("#versionDate"),n=document.querySelector("#versionCommit");Promise.all([fetch(e),fetch("https://api.github.com/repos/zeis974/Securbin/tags"),fetch("https://api.github.com/repos/zeis974/Securbin/commits")]).then(function(e){return Promise.all(e.map(function(e){return e.json()}))}).then(function(e){t.textContent=e[1],o.textContent=e[0].updated_at,n.textContent=e[2][0].sha}).catch(function(e){console.log(e)})}function addNewArray(){const n=document.querySelector("#list"),e=document.querySelector("#list p");if(null!=localStorage.getItem("storedFiles")){let e=localStorage.getItem("storedFiles").split(",");e.forEach(function(e){let t=document.createElement("a");t.setAttribute("href","/"+e),n.appendChild(t);let o=document.createElement("span");o.textContent=e,t.appendChild(o)}),7==e.length&&n.setAttribute("data-scroll","true")}3==n.childNodes.length?e.setAttribute("data-visible","true"):e.setAttribute("data-visible","false")}copyButton.addEventListener("click",copyUrl),copyCodeButton.addEventListener("click",copyCode),buttonOpenVersionContainer.addEventListener("click",openVersionContainer),buttonCloseVersionContainer.addEventListener("click",closeVersionContainer),shareContainer.addEventListener("click",openShareContainer),addNewArray(),"/"===window.location.pathname?copyButton.setAttribute("disabled",""):copyButton.removeAttribute("disabled","");